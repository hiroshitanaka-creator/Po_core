# **Po\_trace Ver.4 Vieweré€£æºå¼·åŒ–ï¼‹é‹ç”¨æ³¨æ„è¨­è¨ˆæ›¸**

## **1\. æ¦‚è¦**

ã“ã®è¨­è¨ˆæ›¸ã¯ã€Po\_trace Ver.4 ã«ãŠã„ã¦ Viewer é€£æºã‚’å¼·åŒ–ã™ã‚‹ãŸã‚ã®ãƒ¡ã‚½ãƒƒãƒ‰è¿½åŠ ã€UIæ§‹é€ åˆ†é›¢ã€ãƒ¡ã‚¿æƒ…å ±APIåŒ–ã€ãŠã‚ˆã³å®Ÿé‹ç”¨æ™‚ã«ãŠã‘ã‚‹Enumã®å–ã‚Šæ‰±ã„æ³¨æ„ç‚¹ã‚’çµ±åˆã—ãŸæ‹¡å¼µæ¡ˆã§ã‚ã‚‹ã€‚

## **2\. TraceEvent æ§‹é€ å¼·åŒ–æ¡ˆï¼šas\_ui\_card()**

Viewerä¸Šã§ã®ã‚«ãƒ¼ãƒ‰è¡¨ç¤ºã«å³åˆ©ç”¨å¯èƒ½ãªæ§‹é€ è¾æ›¸ã‚’è¿”ã™ãƒ¡ã‚½ãƒƒãƒ‰ã€‚

***def as\_ui\_card(self) \-\> dict:***  
    ***return {***  
        ***"timestamp": self.timestamp.isoformat(),***  
        ***"actor": self.actor\_id,***  
        ***"source": self.source,***  
        ***"event": self.event\_type,***  
        ***"reason": {***  
            ***"value": self.reason.value,***  
            ***"label": self.reason.label,***  
            ***"description": self.reason.description***  
        ***},***  
        ***"impact": {***  
            ***"value": self.impact\_on\_chain.value,***  
            ***"label": self.impact\_on\_chain.label,***  
            ***"description": self.impact\_on\_chain.description***  
        ***},***  
        ***"chain\_id": self.chain\_id***  
    ***}***

## **3\. Enum.label() ã‚’UIã‚»ãƒ¬ã‚¯ãƒˆå¼·åŒ–ã«æ´»ç”¨**

\- Viewerã®ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ã« \`reason.label\` ã‚’è¡¨ç¤ºã™ã‚‹ã¨åˆ†é¡ãŒç›´æ„Ÿçš„ã«ãªã‚‹  
\- ã‚¿ã‚°è¡¨ç¤ºï¼ˆãƒãƒƒã‚¸ç­‰ï¼‰ã«ã‚‚ \`impact.label\` ã‚’ãã®ã¾ã¾ä½¿ãˆã‚‹ï¼ˆä¾‹ï¼šğŸ”å†ã‚¯ãƒ©ã‚¹ã‚¿åŒ–ï¼‰

## **4\. OpenAPIåˆ¶ç´„ã¨ /api/event\_metadata ã®ææ¡ˆ**

\- \`.description\_en()\` ã‚„ \`.label()\` ã¯ FastAPI ã®è‡ªå‹•ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã¯è¡¨ç¤ºã•ã‚Œãªã„ãŸã‚ã€  
  \`/api/event\_metadata\` ãªã©ã§å„Enumã¨ãã®èª¬æ˜ãƒ»ç¿»è¨³æƒ…å ±ã‚’JSONå½¢å¼ã§æä¾›ã™ã‚‹ã®ãŒæœ›ã¾ã—ã„ã€‚

## **5\. DBä¿å­˜æ™‚ã®Enumå–ã‚Šæ‰±ã„**

\- Enumã¯ \`.value\` ã‚’ä¿å­˜ã™ã‚‹ã“ã¨ã§ã€DBã§ã®æ¤œç´¢ã‚„é›†è¨ˆãŒç°¡å˜ã«ãªã‚‹ã€‚  
\- ãƒ­ã‚¸ãƒƒã‚¯ä¸Šã§ã¯å†æ§‹æˆã‚‚å®¹æ˜“ï¼š \`ReasonType(stored\_value)\`

## **6\. çµèª**

Po\_trace Ver.4 ã¯å˜ãªã‚‹å±¥æ­´è¨˜éŒ²ã‹ã‚‰ã€æ„å‘³ãƒ»å½¹å‰²ãƒ»è²¬ä»»ã‚’å¤šå±¤çš„ã«å¯è¦–åŒ–ãƒ»é€£æºã§ãã‚‹çŸ¥çš„ãƒ­ã‚°æ§‹é€ ã«é€²åŒ–ã—ãŸã€‚ã“ã‚Œã‚‰ã®æ‹¡å¼µã«ã‚ˆã‚Šã€Viewerã¨Po\_selfã®ç›¸äº’é‹ç”¨æ€§ã¨æ„å‘³å¯†åº¦ãŒé£›èºçš„ã«é«˜ã¾ã‚‹ã€‚